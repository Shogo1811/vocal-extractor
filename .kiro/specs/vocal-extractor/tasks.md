# 実装計画: ボーカル抽出システム

## 概要

Python FastAPIとHTML/CSS/JavaScriptを使用して、YouTubeや音楽ファイルからボーカル音声を抽出するWebアプリケーションを段階的に実装する。

## タスク

- [ ] 1. プロジェクト構造とコア設定の構築
  - プロジェクトディレクトリ構造を作成
  - FastAPI基本設定とuvicorn設定
  - 依存関係管理（requirements.txt）
  - 基本的なログ設定
  - _要件: 8.4_

- [ ] 2. データモデルとコアインターフェースの実装
  - [ ] 2.1 データモデルクラスの作成
    - Job、JobStatus、AudioFileクラスの実装
    - Pydanticモデルでのバリデーション
    - _要件: 3.2, 4.1_

  - [ ]* 2.2 データモデルのプロパティテスト作成
    - **プロパティ 1: ファイル入力検証**
    - **検証対象: 要件 1.1, 1.2, 1.3**

- [ ] 3. ファイル処理サービスの実装
  - [ ] 3.1 FileProcessorクラスの実装
    - ファイル形式検証機能
    - ファイルサイズチェック機能
    - 音声ファイル変換機能（pydub使用）
    - _要件: 1.1, 1.2, 1.3_

  - [ ]* 3.2 ファイル処理のプロパティテスト
    - **プロパティ 1: ファイル入力検証**
    - **検証対象: 要件 1.1, 1.2, 1.3**

  - [ ]* 3.3 ファイル処理のユニットテスト
    - 各種音声形式のテスト
    - エラーケースのテスト
    - _要件: 1.1, 1.2, 1.3_

- [ ] 4. YouTube ダウンローダーの実装
  - [ ] 4.1 YouTubeDownloaderクラスの実装
    - yt-dlpを使用した音声ダウンロード
    - URL検証機能
    - 動画情報取得機能
    - _要件: 2.1, 2.2, 2.3_

  - [ ]* 4.2 YouTube処理のプロパティテスト
    - **プロパティ 3: YouTube URL処理**
    - **検証対象: 要件 2.1, 2.2, 2.3**

  - [ ]* 4.3 YouTube処理のユニットテスト
    - 有効/無効URLのテスト
    - エラーハンドリングのテスト
    - _要件: 2.1, 2.2, 2.3_

- [ ] 5. AI音源分離エンジンの実装
  - [ ] 5.1 VocalExtractorクラスの実装
    - spleeterまたはdemucsを使用した音源分離
    - 進捗追跡機能
    - 一時ファイル管理
    - _要件: 3.1, 3.2, 3.5_

  - [ ]* 5.2 音源分離のプロパティテスト
    - **プロパティ 4: ボーカル抽出処理**
    - **プロパティ 6: 音質保持**
    - **検証対象: 要件 3.1, 3.2, 3.5**

  - [ ]* 5.3 音源分離のユニットテスト
    - 各種音楽ファイルでのテスト
    - 処理失敗時のテスト
    - _要件: 3.1, 3.2, 3.3_

- [ ] 6. ジョブ管理システムの実装
  - [ ] 6.1 JobManagerクラスの実装
    - 非同期ジョブ作成と管理
    - 進捗追跡とステータス更新
    - キューイング機能
    - _要件: 7.1, 7.2, 7.3, 7.4_

  - [ ]* 6.2 ジョブ管理のプロパティテスト
    - **プロパティ 12: 同時処理管理**
    - **検証対象: 要件 7.1, 7.2, 7.3, 7.4**

- [ ] 7. チェックポイント - コア機能の確認
  - すべてのテストが通ることを確認し、質問があれば用户に尋ねる

- [ ] 8. FastAPI エンドポイントの実装
  - [ ] 8.1 ファイルアップロードエンドポイント
    - POST /upload の実装
    - ファイル検証とアップロード処理
    - 進捗表示機能
    - _要件: 1.1, 1.2, 1.3, 1.4_

  - [ ] 8.2 YouTube処理エンドポイント
    - POST /youtube の実装
    - URL検証とダウンロード処理
    - _要件: 2.1, 2.2, 2.3, 2.4_

  - [ ] 8.3 ステータス確認エンドポイント
    - GET /status/{job_id} の実装
    - リアルタイム進捗更新
    - _要件: 3.4_

  - [ ] 8.4 ダウンロードエンドポイント
    - GET /download/{file_id} の実装
    - ファイル配信とクリーンアップ
    - _要件: 4.1, 4.2, 4.3, 4.4_

  - [ ] 8.5 プレビューエンドポイント
    - GET /preview/{file_id} の実装
    - 30秒制限付きプレビュー
    - _要件: 6.1, 6.4_

  - [ ]* 8.6 APIエンドポイントのプロパティテスト
    - **プロパティ 2: 進捗表示の一貫性**
    - **プロパティ 5: エラーハンドリングの一貫性**
    - **プロパティ 7: ダウンロード機能**
    - **検証対象: 要件 1.4, 2.4, 3.3, 3.4, 4.1, 4.2, 4.3, 5.4**

- [ ] 9. フロントエンド実装
  - [ ] 9.1 基本HTMLページの作成
    - メインページのHTML構造
    - レスポンシブデザインのCSS
    - _要件: 5.1, 5.5_

  - [ ] 9.2 ファイルアップロード機能
    - ドラッグ&ドロップ対応
    - 進捗バー表示
    - _要件: 1.4, 5.2, 5.3_

  - [ ] 9.3 YouTube URL入力機能
    - URL入力フォーム
    - 検証とエラー表示
    - _要件: 2.1, 2.2, 5.2, 5.4_

  - [ ] 9.4 処理状況表示機能
    - リアルタイム進捗更新
    - ローディングアニメーション
    - _要件: 3.4, 5.3_

  - [ ] 9.5 結果表示とダウンロード機能
    - 処理完了通知
    - ダウンロードボタン
    - _要件: 4.1, 4.2, 5.2_

  - [ ] 9.6 オーディオプレーヤー機能
    - HTML5 audioプレーヤー
    - 基本コントロール（再生、一時停止、シーク）
    - 時間表示
    - _要件: 6.1, 6.2, 6.3_

  - [ ]* 9.7 フロントエンドのプロパティテスト
    - **プロパティ 9: UI要素の提供**
    - **プロパティ 10: レスポンシブデザイン**
    - **プロパティ 11: プレーヤー機能**
    - **検証対象: 要件 5.2, 5.3, 5.5, 6.1, 6.2, 6.3**

- [ ] 10. セキュリティとバリデーション強化
  - [ ] 10.1 入力サニタイゼーション
    - XSS対策の実装
    - SQLインジェクション対策
    - _要件: 8.2, 8.3_

  - [ ] 10.2 ファイルアップロードセキュリティ
    - 悪意のあるファイル検出
    - ファイルタイプ検証強化
    - _要件: 8.1, 8.3_

  - [ ]* 10.3 セキュリティのプロパティテスト
    - **プロパティ 13: 入力検証とセキュリティ**
    - **検証対象: 要件 8.1, 8.2, 8.3**

- [ ] 11. ログ記録とモニタリング
  - [ ] 11.1 包括的ログシステム
    - 処理ログの記録
    - エラーログの記録
    - パフォーマンスログ
    - _要件: 8.4_

  - [ ]* 11.2 ログ記録のプロパティテスト
    - **プロパティ 14: ログ記録**
    - **検証対象: 要件 8.4**

- [ ] 12. ファイルクリーンアップシステム
  - [ ] 12.1 自動クリーンアップ機能
    - 24時間後の自動削除
    - バックグラウンドタスク実装
    - _要件: 4.4_

  - [ ]* 12.2 クリーンアップのプロパティテスト
    - **プロパティ 8: ファイルクリーンアップ**
    - **検証対象: 要件 4.4**

- [ ] 13. 統合とワイヤリング
  - [ ] 13.1 全コンポーネントの統合
    - すべてのサービスを接続
    - エンドツーエンドフローの確認
    - _要件: 全要件_

  - [ ]* 13.2 統合テスト
    - エンドツーエンドフローのテスト
    - パフォーマンステスト
    - _要件: 全要件_

- [ ] 14. 最終チェックポイント - 全機能テスト
  - すべてのテストが通ることを確認し、質問があれば用户に尋ねる

## 注意事項

- `*`マークのタスクはオプションで、より迅速なMVP開発のためスキップ可能
- 各タスクは特定の要件への追跡可能性を持つ
- チェックポイントで段階的な検証を実施
- プロパティテストは汎用的な正確性プロパティを検証
- ユニットテストは特定の例とエッジケースを検証